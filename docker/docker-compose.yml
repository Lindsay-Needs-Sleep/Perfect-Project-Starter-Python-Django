# requires a valid docker-compose.override.yml to work

version: '3.8'
name: longprojectname

services:

    postgres:
        image: postgres:15.2
        environment:
          - PGDATA=/postgresql/data
        volumes:
          - type: volume
            source: postgres-data
            target: /postgresql/data
            volume:
                nocopy: true

    python:
        image: shortprojectname.python:0.0
        build:
            context: ../
            dockerfile: ./docker/python.Dockerfile
            args:
                - USER_UID=${CURRENT_HOST_USER_UID}
                - USER_GID=${CURRENT_HOST_USER_GID}
                - USERNAME=py
        user: ${CURRENT_HOST_USER_UID}:${CURRENT_HOST_USER_GID}
        # If we want multiple commands
        # command: bash -c "${PYTHON_CONTAINER_COMAND}"
        command: ${PYTHON_CONTAINER_COMAND}
        working_dir: /back_src
        volumes:
          - type: volume
            source: back-src-volume
            target: /back_src
          - type: volume
            source: front-src-volume
            target: /front_src
        ports:
          - "8080:8000"
        depends_on:
          - postgres

    front:
        image: node:19.9.0
        user: ${CURRENT_HOST_USER_UID}:${CURRENT_HOST_USER_GID}
        working_dir: /front_src/components
        volumes:
          - type: volume
            source: front-src-volume
            target: /front_src

volumes:
    postgres-data:

